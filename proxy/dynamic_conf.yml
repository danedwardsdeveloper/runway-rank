http:
   routers:
      backend:
         rule: 'PathPrefix(`/api/`)'
         service: backend
         entryPoints:
            - web
            - websecure
         middlewares:
            - cors

      images:
         rule: 'PathPrefix(`/api/images/`)'
         service: backend
         entryPoints:
            - web
            - websecure
         middlewares:
            - cors
            - add-image-headers

      frontend:
         rule: 'PathPrefix(`/`)'
         service: frontend
         entryPoints:
            - web
            - websecure

   services:
      frontend:
         loadBalancer:
            servers:
               - url: 'https://runway-rank.fly.dev'

      backend:
         loadBalancer:
            servers:
               - url: 'https://runway-rank-server.fly.dev'

   middlewares:
      cors:
         headers:
            accessControlAllowMethods:
               - GET
               - POST
               - PUT
               - DELETE
               - OPTIONS
            accessControlAllowOriginList:
               - https://runway-rank.fly.dev
            accessControlAllowCredentials: true
            accessControlMaxAge: 100
            accessControlAllowHeaders:
               - 'Content-Type'
               - 'Authorization'
               - 'X-Requested-With'
            addVaryHeader: true
         cors:
            allowCredentials: true
            allowOrigin: 'https://runway-rank.fly.dev'
            allowMethods:
               - GET
               - POST
               - PUT
               - DELETE
               - OPTIONS
            allowHeaders:
               - 'Content-Type'
               - 'Authorization'
               - 'X-Requested-With'

      securityHeaders:
         headers:
            stsSeconds: 31536000
            stsIncludeSubdomains: true
            stsPreload: true
            customFrameOptionsValue: 'SAMEORIGIN'
            contentTypeNosniff: true
            browserXssFilter: true
            referrerPolicy: 'strict-origin-when-cross-origin'
            permissionsPolicy: 'camera=(), microphone=(), geolocation=()'
      add-image-headers:
         headers:
            customResponseHeaders:
               X-Content-Type-Options: 'nosniff'
               Access-Control-Allow-Origin: 'https://runway-rank.fly.dev'
               Content-Type: 'image/webp'

tls:
   options:
      default:
         minVersion: VersionTLS12
         sniStrict: true
